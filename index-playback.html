<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <title>Playback</title>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../css/main.css">
    <!-- JS -->
    <script src="../js/vendor/jquery/dist/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>

  </head>
  <body>
    <div id="playback_screen" class="screen">
      <video id="playback_video" autoplay="" muted=""></video>
    </div>

    <script type="text/javascript">

      /* Set up Socket.IO */
      var address = '//localhost:7770';
      var socket = io.connect(address);

      socket.on('handshake', function(data) {
          socket.emit('handshake-response', {clientId: 'playback'});
      });

      socket.on('video-playback', function(data) {
          startVideoPlayback(data.videoURL);
      });

      socket.on('error', function() { console.error(arguments) });
      socket.on('message', function() { console.log(arguments) });


      /* Video Playback */
      var videoOut = document.getElementById('playback_video');

      function startVideoPlayback(videoURL) {

        console.log('startVideoPlayback', videoURL);

        //For immediate playback
        videoOut.src = videoURL;
        videoOut.play();

        //Slow down playback
        // videoOut.playbackRate = 0.25;

        videoOut.onended = function(e) {
          clearPlaybackVideo(videoURL);
        };

      };

      function clearPlaybackVideo(videoURL) {

        //Remove video from Blob memory
        console.log("clearPlaybackVideo:", videoURL);
        videoOut.src = '';
        URL.revokeObjectURL(videoURL);

      }

    </script>

  </body>
</html>